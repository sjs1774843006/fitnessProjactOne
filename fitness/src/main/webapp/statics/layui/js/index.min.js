	$(function() {
		
		$("#addUserBtn").linkbutton({
			iconCls : 'icon-add',
			text : '添加',
			onClick : addWin,
		});
		
		
		$("#saveBtn").linkbutton({
			iconCls : 'icon-save',
			text : '保存',
			onClick : save,
		});
		 
		$('#saveBtn').linkbutton('disable');

		$("#deleteBtn").linkbutton({
			iconCls : 'icon-remove',
			text : '删除',
			onClick : del,
		});
		
		$("#cancelBtn").linkbutton({
			iconCls : 'icon-cancel',
			text : '取消',
			onClick : cancel,
		});
		
		$('#cancelBtn').linkbutton('disable');

		$("#editBtn").linkbutton({
			iconCls : 'icon-edit',
			text : '编辑',
			onClick : edit,
		});
		
		$('#addUserBtn').hide();
		$('#saveBtn').hide();
		$('#deleteBtn').hide();
		$('#cancelBtn').hide();
		$('#editBtn').hide();
		
		$('#tt').textbox().textbox('addClearBtn', 'icon-clear');
		
	})
	
	var flag2 = 1;
	var flag = 1;
	var indexRow;
	

	//结束编辑
	function save() {
		$("#list").datagrid("endEdit", indexRow);
		flag2 = 1
	}

	var sid = null;
	var id;

	


	//取消
	function cancel() {
		parent.$.messager.confirm('警告','你确定取消当前操作?',function(r){
		    if (r){
		    	$("#list").datagrid("rejectChanges");
				flag2 = 1
				$('#cancelBtn').linkbutton('disable');
				$('#saveBtn').linkbutton('disable');
		    }
		});
	}

	//编辑
	function edit() {
		if (flag2 == 2) {
			$.messager.show({
				title : '提示信息',
				msg : '请完成当前操作',
			});
		} else {
			var sid = $("#list").datagrid("getSelected");
			var rowIndex = $('#list').datagrid('getRowIndex', sid);
			if (sid == null) {
				$.messager.show({
					title : '提示信息',
					msg : '请选择需要修改的行',
				})
			} else {
				$('#cancelBtn').linkbutton('enable');
				$('#saveBtn').linkbutton('enable');
				indexRow = rowIndex;
				$('#list').datagrid('beginEdit', rowIndex);
				flag2 = 2;
			}
		}
	}

	function startEdit(index, row) {
		flag2 = 2;
	}

	
	
	$.extend($.fn.textbox.methods, {
		addClearBtn: function(jq, iconCls){
			return jq.each(function(){
				var t = $(this);
				var opts = t.textbox('options');
				opts.icons = opts.icons || [];
				opts.icons.unshift({
					iconCls: iconCls,
					handler: function(e){
						$(e.data.target).textbox('clear').textbox('textbox').focus();
						$(this).css('visibility','hidden');
					}
				});
				t.textbox();
				if (!t.textbox('getText')){
					t.textbox('getIcon',0).css('visibility','hidden');
				}
				t.textbox('textbox').bind('keyup', function(){
					var icon = t.textbox('getIcon',0);
					if ($(this).val()){
						icon.css('visibility','visible');
					} else {
						icon.css('visibility','hidden');
					}
				});
			});
		}
	});
	
	//搜索
	function search(params) {
		
		var combobox = $("#state").val();
		var queryObject = $("#list").datagrid("options").queryParams;
		if (params == "") {
			params = "null";
		}
		queryObject.userid = params;
		queryObject.combobox = combobox;
		$("#list").datagrid("options").queryParams = queryObject;
		$("#list").datagrid("reload");
	}
	
	
	function  controlButton(data){
		$.each(data,function(k,v){
			$.each(v,function(key,val){
				if(val=="add"){
					$('#addUserBtn').show();
					$('#saveBtn').show();
					$('#cancelBtn').show();
				}else if(val=="del"){
					$('#deleteBtn').show();
				}else if(val=="update"){
					$('#editBtn').show();
					$('#saveBtn').show();
					$('#cancelBtn').show();
				}
			})
		})
	}